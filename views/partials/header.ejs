<header>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/fontawesome-free-6.5.1-web/css/all.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/avatar.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <div class="container">

        <nav class="navigation">
            <p class="welcome">
                <%= user.email %>
            </p>
            <i class="fa-regular fa-bell custom-icon"></i>
            <i id="newBlog" class="fa-regular fa-pen-to-square custom-icon"></i>
            <div class="avatar">
                <img src="<%= user.path %>" alt="Avatar">

                <div class="dropdown-content">
                    <a id="editProfile">Edit Profile</a>
                    <a id="signout">Sign Out</a>
                    <a href="#">Option 3</a>
                </div>
            </div>
        </nav>
    </div>


    <hr>

    <div id="navbar">
        <a href="#home">Home</a>
        <a href="#news">News</a>
        <a href="#contact">Contact</a>
    </div>

    <div id="popupContainer" class="popup">

        <div class="popup-content">
            <span class="close" id="closeButton">&times;</span>
            <form id="blog" action="/blogs/add-blogs" method="post" enctype="multipart/form-data">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" required>

                <label for="snippet">snippet:</label>
                <input id="snippet" type="text" id="snippet" name="snippet" required>

                <label for="content">Content:</label>
                <textarea id="blogbody" name="blogbody" rows="4" required></textarea>

                <button type="submit">Submit</button>
            </form>
        </div>
    </div>
    <div id="editprofile" class="edit-profile">

        <div class="content">

            <span class="close-edit" id="closeButton_edit">&times;</span>

            <div class="avatar-upload">
                <div class="avatar-edit">
                    <form id="form-image" enctype="multipart/form-data">
                        <input type='file' name="picture" id="imageUpload" accept="picture/*" />
                        <label for="imageUpload"></label>
                        <div class="row gx-3 mb-3">

                            <!-- <div class="col-md-6">
                                <label class="small mb-1" for="inputFirstName">First name</label>
                                <input class="form-control" id="inputFirstName" type="text"
                                    placeholder="Enter your first name" value="Valerie">
                            </div> -->
                            <div class="row gx-3 mb-3">

                                <!-- <div class="col-md-6">
                                    <label class="small mb-1" for="inputFirstName">First name</label>
                                    <input class="form-control" id="inputFirstName" type="text"
                                        placeholder="Enter your first name" value="Valerie">
                                </div> -->

                                <!-- <div class="col-md-6">
                                    <label class="small mb-1" for="inputLastName">Last name</label>
                                    <input class="form-control" id="inputLastName" type="text"
                                        placeholder="Enter your last name" value="Luna">
                                </div> -->
                            </div>
                        </div>
                        <button onclick="updateUser()">Save</button>
                    </form>

                </div>
                <!-- <div class="avatar-preview">
                    <img class="profile-user-img img-responsive img-circle" id="imagePreview" src="<%= user.path %>" alt="User profile picture">
                </div> -->
                <% if (user && user.path) { %>
                    <div class="avatar-preview">
                        <img class="profile-user-img img-responsive img-circle" id="imagePreview"
                        src="http://localhost:3000/image/<%= user.path %>" alt="User profile picture">
                    </div>
                    <% } else { %>
                        <div class="avatar-preview">
                            <img class="profile-user-img img-responsive img-circle" id="imagePreview"
                                src="placeholder.jpg" alt="User profile picture">
                        </div>
                        <% } %>

            </div>

        </div>
</header>

<body>
    <script src="js/header.js"> </script>

    <script>
        function updateUser() {
            // Get the form element
            const form = document.getElementById('form-image');
            const image = document.getElementById('form-image');
            const formData = new FormData(form);

            fetch('/update-info', {
                method: 'PUT',

                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        alert('User profile updated successfully');
                        // Optionally, redirect to another page or perform other actions
                    }
                    else if (response.status === 400) {
                        alert('Bad request: Please check the submitted data.');
                    } else if (response.status === 500) {
                        alert('Internal server error: Something went wrong on the server.');
                    } else {
                        alert('Failed to update user profile');
                    }

                })
                .catch(error => {
                    console.error('Error updating user profile:', error);
                    alert('Internal server error');
                });

        }

    </script>
</body>